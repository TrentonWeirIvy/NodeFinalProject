<html lang="en">
<%- include("./partials/head.ejs") %>

<body>
  <%- include("./partials/nav.ejs") %>

  <div class="content container">
    <h2 class="modern-title"><%= pageTitle %></h2>

    <!-- Course Form -->
    <form action="<%= formAction %>" method="POST" class="modern-form">
      <div class="form-group">
        <label for="courseName" class="modern-label">Course Name:</label>
        <input data-id="<%= course && course.id !== undefined ? course.id : null %>" type="text" id="courseName" name="courseName" value="<%= course ? course.name : '' %>" class="custom-input" required>

      </div>

      <div class="form-group">
        <label for="teacher" class="modern-label">Teacher:</label>
        <div>
          <div class="select-wrapper">
            <select id="teacher" name="teacher" class="select custom-select" required>
              <% teachers.forEach(teacher => { %>
                <option value="<%= teacher.id %>" <%= course && course.teacher.name === teacher.name ? 'selected' : '' %>><%= teacher.name %></option>
              <% }); %>
            </select>
            <div class="select-arrow">&#9660;</div>
            <div class="select-dropdown">
              <!-- Dropdown options go here -->
            </div>
          </div>
        </div>
        
        
      </div>

      <button id="submitButton" type="button" class="button modern-button"><%= buttonLabel %></button>
    </form>
  </div>

  <%- include("./partials/footer.ejs") %>


  <script>

      const inputCourseName = document.querySelector('#courseName');
      const select = document.querySelector('select');
      const input = document.querySelector('input');

      inputCourseName.focus();


      const getCookie = async () => {
        return sessionStorage.getItem('courseId');
      }
      const setUpForm = async () => {
        const courseId = await getCookie();
        const teachers = await axiosGet('../api/teachers');
        const course = await axiosGet(`../api/courses/${JSON.stringify(courseId)}`);
        teachers.forEach(teach => {
          const opt = document.createElement('option');
          opt.value = teach._id;
          opt.innerText = teach.name;
          if(course.teacher == teach._id){
            opt.selected = true;
          }
          select.append(opt);
        })

      }
      setUpForm();
  
      document.querySelector('#submitButton').addEventListener('click', () => {
        const newCourse = {
          id: inputCourseName.getAttribute('data-id'),
          name: inputCourseName.value,
          teacher: document.querySelector('#teacher').value
        };
  
        // Send a POST request to create a new course
        axios.post(`../api/course/${JSON.stringify(newCourse)}`).then(res => {
          console.log(res);
          if (res.status === 200) {
            alert('Course Created, ID: ' + res.data);
          } else {
            alert('Failed to create ' + newCourse.name);
          }
        }).then(window.location.assign(`${window.location.origin}\\courses`)).catch(e => alert(e));
      });
  </script>
  >
</body>

</html>
